# http://nginx.org/en/docs/ngx_core_module.html#worker_processes
# Defines the number of worker processes
# The optimal values depends on(but not limited to):
#     - Number of CPU cores
#     - Number of HD
#     - Load pattern
worker_processes auto;

# http://nginx.org/en/docs/ngx_core_module.html#worker_connections
# Sets the maximum number of simultaneous connections
# that can be opened by a worker process
events { worker_connections 1024; }

http {

    upstream api_server {
      server api:8070 fail_timeout=180s;
    }

    upstream auth_server {
      server auth:8080 fail_timeout=180s;
    }

    server {
      listen 80;
      server_name 0.0.0.0;

      location ^~ /api/ {
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_pass http://api_server;
        proxy_set_header Host $host;
        proxy_redirect off;
      }
      location ^~ /auth/ {
        proxy_pass http://auth_server;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $host;
        proxy_redirect off;
      }
    }
}
